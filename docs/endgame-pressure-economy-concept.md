# Pixel City Builder: Endgame + Pressure Economy Concept (v0.1)

## 1. Цель документа
Сформировать рабочую концепцию эндгейма, где:
- город не уходит в бесконечный пассивный рост;
- появляется нарастающее алгоритмическое давление (в духе RimWorld storyteller);
- катастрофы и кризисы требуют системных решений (в духе SimCity);
- требования граждан становятся главным драйвером развития;
- монетизация не ломает баланс (без pay-to-win).

## 2. Северная звезда дизайна
Игрок в эндгейме должен принимать сложные управленческие решения под давлением, а не просто увеличивать производство.

Ключевая формула цикла:
1. Рост города повышает доходы и открывает новые возможности.
2. Рост автоматически повышает сложность и уязвимости.
3. Директор событий бьет по слабым местам города.
4. Игрок перестраивает систему и повышает устойчивость.
5. За устойчивость получает мета-прогресс и доступ к мегапроектам.

## 3. Экономика эндгейма

## 3.1 Ресурсные слои
- Базовые: `wood`, `stone`, `food`, `coins`.
- Промежуточные: `planks`, `bricks`, `tools`, `cloth`.
- Индустриальные: `metal`, `glass`, `energy`, `water_res`.
- Знание/престиж: `science`, `culture`, `fame`.
- Стабильность (новые метрики): `public_order`, `health_index`, `infrastructure_integrity`, `ecology`.

## 3.2 Анти-снежный ком
Ввести постоянные расходы, которые масштабируются от размера города:
- обслуживание дорог/сетей;
- зарплаты сервисов;
- энергозатраты жилого фонда;
- потери от износа инфраструктуры.

Пример:
`maintenanceCostPerSec = base + population * k1 + totalBuildingLevel * k2`

Если бюджет отрицательный:
- растет риск ивентов;
- снижается качество услуг;
- ускоряется деградация инфраструктуры.

## 3.3 Раковины ресурсов (endgame sinks)
- Мегапроекты (многоэтапные стройки с огромной стоимостью).
- Экстренные меры в кризисах (дорогие, но быстрые).
- Программы благополучия (долгосрочное снижение рисков).
- Страховые/резервные фонды на случай катастроф.

## 3.4 Макро-шоки
Ввести волатильность рынка:
- инфляция строительства;
- экспортные/импортные цены;
- топливные/энергетические шоки.

Это делает стратегию "один идеальный билд" нестабильной.

## 4. Директор давления (RimWorld-style)

## 4.1 Индекс давления
Каждую минуту считается `pressureIndex` в диапазоне `0..100`.

Компоненты:
- `cityScaleScore` (население, уровень, количество зданий);
- `deficitScore` (дефицит еды/энергии/воды/денег);
- `unrestScore` (низкое счастье, пробки, преступность);
- `fragilityScore` (изношенность, перегруженные сети);
- `recentSuccessScore` (слишком быстрое развитие = больше внимания системы);
- `difficultyModifier`.

Упрощенная формула:
`pressureIndex = clamp(0, 100, A + B + C + D + E + difficultyModifier - resilienceBonus)`

Где `resilienceBonus` дают:
- резервные мощности;
- высокий уровень сервисов;
- страховые фонды;
- успешные антикризисные решения за последние N минут.

## 4.2 Фазы давления
- `0-25`: Спокойствие (редкие локальные проблемы).
- `26-50`: Напряжение (цепочки проблем, рост требований).
- `51-75`: Кризис (системные сбои, комбинированные ивенты).
- `76-100`: ЧС (катастрофы, мульти-удары, ограниченное время на реакцию).

## 4.3 Алгоритм выбора ивента
1. Директор выбирает уязвимость с максимальным весом (энергия, вода, транспорт, бюджет, здоровье).
2. Фильтрует ивенты по фазе давления и биому карты.
3. Добавляет вероятность "комбо-ивента" (в кризисной фазе).
4. Создает окно предупреждения (если не внезапная катастрофа).
5. Применяет краткосрочный эффект + пост-эффект (aftershock).

Принцип честности:
- игра всегда показывает причину кризиса;
- у игрока есть минимум 2 пути реакции (дешевый/дорогой, быстрый/устойчивый).

## 5. Каталог ивентов (SimCity-style + системные кризисы)

## 5.1 Природные катастрофы
- Землетрясение:
  - триггер: высокий `fragilityScore`;
  - эффект: повреждение зданий, разрывы дорог, просадка энергии;
  - пост-эффект: афтершоки 2-5 минут.
- Метеорит:
  - триггер: поздняя стадия + высокий `cityScaleScore`;
  - эффект: уничтожение тайлов, пожар, падение счастья;
  - пост-эффект: зона заражения/радиации (дебафф).
- Наводнение:
  - триггер: сезон дождей + слабая дренажная инфраструктура;
  - эффект: отключение районов, снижение производства.
- Засуха:
  - триггер: высокий расход воды + низкий запас;
  - эффект: резкое падение food и happiness.

## 5.2 Техногенные и социальные кризисы
- Блэкаут:
  - триггер: перегрузка сети;
  - эффект: остановка индустрии, рост преступности.
- Жилищный кризис:
  - триггер: population растет быстрее жилья;
  - эффект: штраф к счастью, миграционный отток.
- Транспортный коллапс:
  - триггер: высокая плотность без апгрейда дорог;
  - эффект: штраф ко всем цепочкам поставок.
- Эпидемия:
  - триггер: низкий `health_index`, высокая плотность;
  - эффект: падение workforce, расходы на медицину.
- Бюджетный кризис:
  - триггер: отрицательный cashflow > N минут;
  - эффект: автоматическое урезание сервисов и рост недовольства.

## 5.3 Позитивные окна возможностей
- Инвестгрант, технологический прорыв, туристический бум.
- Позитивные ивенты реже при высоком давлении, но сильнее при хорошей устойчивости.

## 6. Требования граждан к городу

## 6.1 Модель потребностей
Вместо одного happiness использовать вектор качества жизни:
- `housing`;
- `food_access`;
- `water_access`;
- `energy_reliability`;
- `healthcare`;
- `safety`;
- `education`;
- `mobility`;
- `ecology`;
- `leisure`;
- `tax_fairness`.

Итог:
`citizenSatisfaction = weightedSum(needs) - crisisPenalty`

## 6.2 Социальные группы
Ввести минимум 3 группы:
- Рабочие (чувствительны к ценам, транспорту, базовой медицине).
- Средний класс (важны экология, образование, досуг).
- Элита/инноваторы (важны культура, безопасность, престиж, низкие сбои).

Требования групп растут с уровнем города.

## 6.3 Система запросов граждан
Каждые N минут формируется `Citizen Request`:
- "Снизьте преступность до X";
- "Дайте Y% покрытие воды";
- "Снизьте время дороги до Z".

Формат:
- дедлайн;
- награда;
- штраф при провале;
- вклад в фазу давления.

## 6.4 Политики управления
Игрок выбирает политику:
- Аскетичная экономика (низкие расходы, выше риск кризисов).
- Социальное государство (высокие расходы, выше стабильность).
- Технократия (ускорение науки, штраф к социальному блоку).

Политика меняет веса потребностей и вероятность определенных ивентов.

## 7. Уровни сложности

Профили:
- `Governor` (базовый).
- `Survival` (выше штрафы дефицитов, чаще комбинированные кризисы).
- `Cataclysm` (частые катастрофы, короткие дедлайны, дорогие ошибки).

Адаптивность:
- если игрок стабилен 10+ минут, система повышает давление плавно;
- если игрок на грани коллапса, система не добивает мгновенно, а дает окно 60-120 сек на восстановление.

## 8. Эндгейм-контент

## 8.1 Мегапроекты
Примеры:
- Orbital Elevator;
- Arcology District;
- Global Finance Hub;
- Climate Shield Array.

Каждый мегапроект:
- требует ресурсов из разных слоев;
- повышает требования граждан;
- дает уникальный бонус и новый класс угроз.

## 8.2 Престиж 2.0 (мета-прогресс)
Звезды престижа тратятся в доктринах:
- `Industry`;
- `Civil Services`;
- `Crisis Response`;
- `Science`;
- `Culture`.

Игрок выбирает специализацию, а не просто получает общий % бонус.

## 8.3 Сезонные сценарии
- фиксированный seed;
- набор модификаторов;
- лидерборд по очкам устойчивости и скорости выполнения целей.

## 9. Монетизация без ломки баланса

## 9.1 Базовый принцип
Продаем контент, вариативность и удобство, а не силу.

Разрешено:
- косметика (скины зданий, стили UI, эффекты погоды);
- DLC-сценарии и биомы;
- Crisis Packs (новые классы угроз, цепочки катастроф, уникальные ответные механики);
- premium QoL (доп. статистика, planner overlays, дополнительные слоты, расширенный аналитический HUD).

Ограничения:
- не продавать ресурсы/мощь;
- не продавать иммунитет к кризисам;
- не вырезать обязательный базовый набор катастроф из base game;
- никакой обязательной рекламы для core loop.

## 9.2 Целевая модель выручки ($1M за 6 месяцев)
Рекомендуемая модель: `Premium base game + DLC + Upgrade packs + cosmetics`.

Примерная целевая раскладка (gross):
1. Base game: `~50k` копий x `$19.99` = `$999,500`.
2. DLC attach rate: `20-25%` на первый Crisis Pack.
3. DLC attach rate: `10-15%` на второй pack.
4. Cosmetic/QoL attach rate: `8-12%`.

Даже при умеренном attach DLC итоговая выручка перекрывает `$1M` gross.

## 9.3 Каталог DLC (платный контент)
1. `Crisis Pack: Fault Lines`
- Землетрясения, афтершоки, обвалы, стандарты сейсмоустойчивости.
2. `Crisis Pack: Impact Winter`
- Метеориты, пожары, токсичные зоны, эвакуационные сценарии.
3. `Crisis Pack: Civic Friction`
- Массовые протесты, бюджетные кризисы, социальные реформы.
4. `Biome Pack`
- Новые биомы с отдельными правилами логистики и ресурсов.
5. `Scenario Pack`
- Сценарии с уникальными стартовыми условиями, ограничениями, победными условиями.

Формат DLC:
- 1-2 новые системные механики;
- 8-15 часов нового прохождения;
- 1-2 уникальных мегапроекта;
- новые достижения/челленджи.

## 9.4 Форматы улучшений (upgrades)
1. `Standard -> Deluxe Upgrade`
- апгрейд без повторной покупки базовой версии.
2. `Year 1 Pass`
- 2-3 DLC со скидкой 15-20%.
3. `Founder/Supporter Pack`
- саундтрек, артбук, уникальные косметики, имя в титрах.
4. `Complete Bundle`
- база + основные DLC + косметика с лучшей ценой.

## 9.5 Soft push (мягкий upsell)
1. Контекстный оффер после прохождения первого крупного кризиса:
- "Открыть расширенный набор катастроф."
2. Discovery-сэмпл:
- один пробный DLC-ивент на сессию, затем предложение купить pack.
3. Персональные рекомендации:
- если игрок любит high-pressure режим, показывать Crisis DLC в приоритете.
4. Bundle-first storefront:
- сперва показывать наборы, затем одиночные DLC.
5. Win-back окна:
- оффер через 14/30 дней неактивности с упором на новый контент, а не скидку ради скидки.

## 9.6 Мобильный компромисс (если порт будет mobile)
- rewarded ads только опционально и только на time-saving бонусы;
- жесткий кулдаун;
- без блокировки прогресса рекламой;
- весь paid-content одинаково доступен через прямую покупку без просмотра рекламы.
- продажа дополнений как в мобильной версии

## 10. MVP-план внедрения в текущий проект

Этап 1 (кор):
1. Добавить `pressureIndex` и фазы давления.
2. Перевести текущие ивенты на систему весов и уязвимостей.
3. Ввести 3-4 кризиса: блэкаут, засуха, жилищный кризис, транспортный коллапс.

Этап 2 (граждане):
1. Ввести 4 базовые потребности: `housing`, `water`, `energy`, `safety`.
2. Показывать индексы в UI.
3. Добавить Citizen Requests с дедлайном.

Этап 3 (эндгейм):
1. Добавить 2 мегапроекта.
2. Добавить доктрины престижа.
3. Добавить профиль сложности `Survival`.

## 11. Метрики успеха
- Средняя длительность успешной сессии в эндгейме.
- Доля игроков, доживших до первой кризисной фазы.
- Win rate по уровням сложности.
- Retention после первого престижа.
- Доля игроков, использующих антикризисные механики.

---

Этот документ задает базу для прототипа v0.1. Следующий шаг: разложить этап 1 на конкретные изменения в `src/events.js`, `src/progression.js`, `src/economy.js` и UI.
